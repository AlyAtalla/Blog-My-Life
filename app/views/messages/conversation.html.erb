<% content_for :title, "Conversation with #{@other.name}" %>

<h3>Conversation with <%= @other.name %></h3>

<div class="mb-3">
  <% @messages.each do |m| %>
    <div class="mb-2">
      <div class="small text-muted"><strong><%= m.sender == current_user ? 'You' : m.sender.name %></strong> â€¢ <%= time_ago_in_words(m.created_at) %> ago</div>
      <div class="p-2" style="background:#f5f5f5;border-radius:.375rem;margin-top:.25rem;max-width:80%;">
        <%= simple_format(h(m.body)) %>
      </div>
    </div>
  <% end %>
</div>

<div class="card p-3">
  <%= form_with model: @message, url: messages_path, local: true do |f| %>
    <%= hidden_field_tag 'message[recipient_id]', @other.id %>
    <div class="mb-2">
      <%= f.text_area :body, class: 'form-control', rows: 3, placeholder: 'Write your message...' %>
    </div>
    <div class="d-flex gap-2">
      <%= f.submit 'Send', class: 'btn btn-primary' %>
      <%= link_to 'Back to inbox', messages_path, class: 'btn btn-outline-secondary' %>
    </div>
  <% end %>
</div>
